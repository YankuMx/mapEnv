<!DOCTYPE html>
<html>
  <head>
    <title>Yanku test</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
      html, body, #map-canvas {
        height: 400px;
        margin: 0px;
        padding: 0px
      }
    </style>
      <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=visualization"></script>
      <script src="jquery-2.1.4.min.js"></script>
    <script>
function initialize() {
  var mapOptions = {
    zoom: 4,
    center: new google.maps.LatLng(22, -101)
  };

  var map = new google.maps.Map(document.getElementById('map-canvas'),
      mapOptions);

        google.maps.event.addListener(map, 'click', function() {
            var zoom = map.getZoom();
            var bounds = map.getBounds();
            var ne = bounds.getNorthEast(); // LatLng of the north-east corner
            var sw = bounds.getSouthWest(); 

            getEnvironmentalData(zoom, ne.lat(), ne.lng(), sw.lat(), sw.lng(),map);
            
        });
    
        google.maps.event.addListener(map, 'zoom_changed', function() {
            console.log(map.getZoom());
        });
    
        google.maps.event.addListener(map, 'dragend', function() {
            console.log(map.getZoom());
        });

}
        
        function getEnvironmentalData(zoom, neLat, neLng , swLat ,swLng,map)
        {

            $.ajax({
              method: "POST",
              asyn: false,
              url: "environmentalData.php",
              data: { zoom: zoom, neLat: neLat, neLng: neLng, swLat:swLat, swLng:swLng }
            })
              .done(function( msg ) {
                
                console.log(msg);
                
                
                /*
                var points = JSON.parse(msg);
                var pointsLength = points.length;
                
                var taxiData = new Array();
                for(var i=0; i!= points.length; i++)
                {
                    taxiData.push(new google.maps.LatLng(points[i].coordinates[0], points[i].coordinates[1]));
                }
                
                var pointarray, heatmap;

                var pointArray = new google.maps.MVCArray(taxiData);

                heatmap = new google.maps.visualization.HeatmapLayer({
                data: pointArray
                });
                heatmap.setMap(null);
                heatmap.setMap(map);
                */
              });

        }

google.maps.event.addDomListener(window, 'load', initialize);

    </script>
  </head>
  <body>
    <div id="map-canvas"></div>
  </body>
</html>